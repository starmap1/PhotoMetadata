<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Tools</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
    <style>
/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   GLOBAL NAV
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --nav-h: 56px;
  --accent: #e8ff47;
  --accent2: #667eea;
  --nav-bg: #0e0e0f;
  --nav-border: #2e2e32;
}

body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

/* Top nav bar */
#app-nav {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: var(--nav-h);
  background: #0e0e0f;
  border-bottom: 1px solid #2e2e32;
  display: flex;
  align-items: center;
  padding: 0 24px;
  gap: 0;
  z-index: 9999;
  box-shadow: 0 2px 20px rgba(0,0,0,0.4);
}

#app-nav .brand {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 22px;
  letter-spacing: 2px;
  color: var(--accent);
  margin-right: 32px;
  white-space: nowrap;
  text-decoration: none;
}

#app-nav .nav-links {
  display: flex;
  gap: 4px;
  height: 100%;
  align-items: center;
}

#app-nav .nav-btn {
  background: none;
  border: none;
  cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  font-size: 13px;
  font-weight: 500;
  color: #888;
  padding: 6px 16px;
  border-radius: 8px;
  letter-spacing: 0.03em;
  transition: all 0.15s;
  display: flex;
  align-items: center;
  gap: 7px;
  white-space: nowrap;
}

#app-nav .nav-btn:hover {
  color: #f0f0f0;
  background: rgba(255,255,255,0.07);
}

#app-nav .nav-btn.active {
  color: #0e0e0f;
  background: var(--accent);
  font-weight: 600;
}

#app-nav .nav-btn.active .nav-icon { filter: none; }

/* Pages */
.page {
  display: none;
  padding-top: var(--nav-h);
  min-height: 100vh;
}

.page.active { display: block; }

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   PAGE 1: METADATA EXTRACTOR ‚Äî dark theme matching watermark studio
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.meta-page {
  background: #0e0e0f;
  min-height: calc(100vh - var(--nav-h));
  padding: 0 24px 60px;
  font-family: 'DM Sans', sans-serif;
  color: #f0f0f0;
  position: relative;
  overflow-x: hidden;
}

.meta-page::before {
  content: '';
  position: fixed;
  inset: 0;
  top: var(--nav-h);
  background: radial-gradient(ellipse at 80% 10%, rgba(232,255,71,0.06) 0%, transparent 50%),
              radial-gradient(ellipse at 20% 80%, rgba(255,107,53,0.05) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}

.meta-page .container {
  position: relative;
  z-index: 1;
  max-width: 1000px;
  width: 100%;
  margin: 0 auto;
}

.meta-page .meta-header {
  padding: 40px 0 32px;
  display: flex;
  align-items: baseline;
  gap: 16px;
}
.meta-page .meta-header h1 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(42px, 6vw, 72px);
  letter-spacing: 2px;
  color: #e8ff47;
  line-height: 1;
  margin-bottom: 0;
  text-align: left;
}
.meta-page .meta-header .meta-subtitle {
  font-size: 13px;
  color: #888;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  font-weight: 500;
}

.meta-page .upload-section { margin-bottom: 20px; }
.meta-page .file-input-wrapper { position: relative; display: inline-block; width: 100%; }
.meta-page .file-input-wrapper input[type="file"] { display: none; }

.meta-page .upload-label {
  display: block;
  padding: 40px 20px;
  border: 2px dashed #2e2e32;
  border-radius: 12px;
  text-align: center;
  cursor: pointer;
  background: #181819;
  transition: all 0.2s;
}
.meta-page .upload-label:hover,
.meta-page .upload-label.drag-over {
  border-color: #e8ff47;
  background: rgba(232,255,71,0.04);
}
.meta-page .upload-icon {
  width: 48px; height: 48px;
  margin: 0 auto 12px;
  background: #222224;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 22px;
}
.meta-page .upload-label p { color: #888; font-size: 14px; margin: 4px 0; }
.meta-page .upload-label p strong { color: #f0f0f0; }
.meta-page .upload-label span { color: #555; font-size: 12px; }

.meta-page .preview-section { display: none; margin-top: 20px; }
.meta-page .preview-section.active { display: block; }
.meta-page .preview-image {
  max-width: 280px; max-height: 280px;
  border-radius: 10px; margin-bottom: 20px;
  border: 1px solid #2e2e32;
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
}

.meta-page .camera-info {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 12px;
  margin-bottom: 16px;
}
.meta-page .camera-info-item {
  background: #222224;
  border: 1px solid #2e2e32;
  border-radius: 10px;
  padding: 16px;
  text-align: center;
}
.meta-page .camera-info-item h4 {
  font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em;
  color: #888; margin-bottom: 6px; font-weight: 500;
}
.meta-page .camera-info-item p { font-size: 15px; font-weight: 600; color: #e8ff47; word-break: break-all; }

.meta-page .metadata-container { margin-bottom: 16px; }
.meta-page .metadata-card {
  background: #181819;
  border: 1px solid #2e2e32;
  border-radius: 12px;
  overflow: hidden;
  margin-bottom: 16px;
}
.meta-page .metadata-card h3 {
  font-size: 11px; font-weight: 500; letter-spacing: 0.12em;
  text-transform: uppercase; color: #888;
  padding: 14px 20px; border-bottom: 1px solid #2e2e32;
  display: flex; align-items: center; gap: 8px;
}
.meta-page .metadata-card h3::before {
  content: ''; width: 6px; height: 6px; border-radius: 50%;
  background: #ff6b35; flex-shrink: 0;
}
.meta-page .metadata-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 1px;
  background: #2e2e32;
}
.meta-page .metadata-item { background: #1a1a1b; padding: 14px 16px; }
.meta-page .metadata-item strong {
  display: block; font-size: 10px; font-weight: 500;
  letter-spacing: 0.08em; text-transform: uppercase; color: #555; margin-bottom: 4px;
}
.meta-page .metadata-item span { font-size: 13px; color: #f0f0f0; }

@media (max-width: 600px) { .meta-page .camera-info { grid-template-columns: 1fr 1fr; } }

.meta-page .loading { text-align: center; padding: 40px 20px; color: #e8ff47; font-weight: 500; font-size: 14px; letter-spacing: 0.05em; }
.meta-page .spinner {
  border: 3px solid #2e2e32; border-top: 3px solid #e8ff47;
  border-radius: 50%; width: 36px; height: 36px;
  animation: spin 0.8s linear infinite; margin: 0 auto 14px;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

.meta-page .error {
  background: rgba(255,85,85,0.08); color: #ff6b6b;
  padding: 16px 20px; border-radius: 10px; margin-top: 16px;
  border: 1px solid rgba(255,85,85,0.25); font-size: 14px;
}

.meta-page .clear-btn {
  background: transparent; color: #f0f0f0;
  border: 1px solid #2e2e32; padding: 10px 20px;
  border-radius: 8px; cursor: pointer;
  font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 500;
  transition: all 0.15s; margin-top: 16px;
  display: inline-flex; align-items: center; gap: 6px;
}
.meta-page .clear-btn:hover { background: #222224; border-color: #e8ff47; color: #e8ff47; }

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   PAGE 2: WATERMARK STUDIO  (dark theme vars scoped to .wm-page)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.wm-page {
  --wm-bg: #0e0e0f;
  --wm-surface: #181819;
  --wm-surface2: #222224;
  --wm-border: #2e2e32;
  --wm-accent: #e8ff47;
  --wm-accent2: #ff6b35;
  --wm-text: #f0f0f0;
  --wm-muted: #888;
  --wm-radius: 12px;

  background: var(--wm-bg);
  color: var(--wm-text);
  font-family: 'DM Sans', sans-serif;
  min-height: calc(100vh - var(--nav-h));
  overflow-x: hidden;
  position: relative;
}

.wm-page::before {
  content: '';
  position: fixed;
  inset: 0;
  top: var(--nav-h);
  background: radial-gradient(ellipse at 20% 10%, rgba(232,255,71,0.06) 0%, transparent 50%),
              radial-gradient(ellipse at 80% 80%, rgba(255,107,53,0.05) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}

.wm-page .wm-container {
  position: relative;
  z-index: 1;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px 60px;
}

.wm-page header {
  padding: 40px 0 32px;
  display: flex;
  align-items: baseline;
  gap: 16px;
}

.wm-page header h1 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(42px, 6vw, 72px);
  letter-spacing: 2px;
  color: var(--wm-accent);
  line-height: 1;
}

.wm-page header span {
  font-size: 13px;
  color: var(--wm-muted);
  letter-spacing: 0.05em;
  text-transform: uppercase;
  font-weight: 500;
}

.wm-page .layout {
  display: grid;
  grid-template-columns: 360px 1fr;
  gap: 20px;
  align-items: start;
}
@media (max-width: 900px) { .wm-page .layout { grid-template-columns: 1fr; } }

.wm-page .panel {
  background: var(--wm-surface);
  border: 1px solid var(--wm-border);
  border-radius: var(--wm-radius);
  overflow: hidden;
}

.wm-page .panel-header {
  padding: 16px 20px;
  border-bottom: 1px solid var(--wm-border);
  font-size: 11px;
  font-weight: 500;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--wm-muted);
  display: flex;
  align-items: center;
  gap: 8px;
}
.wm-page .panel-header::before {
  content: '';
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--wm-accent);
  flex-shrink: 0;
}
.wm-page .panel-body { padding: 20px; }

.wm-page .upload-zone {
  border: 2px dashed var(--wm-border);
  border-radius: var(--wm-radius);
  padding: 40px 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}
.wm-page .upload-zone:hover, .wm-page .upload-zone.drag-over {
  border-color: var(--wm-accent);
  background: rgba(232,255,71,0.04);
}
.wm-page .upload-zone input {
  position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
}
.wm-page .wm-upload-icon {
  width: 48px; height: 48px;
  margin: 0 auto 12px;
  background: var(--wm-surface2);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 22px;
}
.wm-page .upload-zone p { font-size: 14px; color: var(--wm-muted); }
.wm-page .upload-zone p strong { color: var(--wm-text); }

.wm-page .form-group { margin-bottom: 18px; }

.wm-page label {
  display: block;
  font-size: 12px;
  font-weight: 500;
  color: var(--wm-muted);
  letter-spacing: 0.05em;
  text-transform: uppercase;
  margin-bottom: 8px;
}

.wm-page input[type="text"],
.wm-page input[type="number"],
.wm-page select,
.wm-page input[type="color"] {
  width: 100%;
  background: var(--wm-surface2);
  border: 1px solid var(--wm-border);
  border-radius: 8px;
  color: var(--wm-text);
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  padding: 10px 14px;
  outline: none;
  transition: border-color 0.2s;
}
.wm-page input[type="text"]:focus,
.wm-page input[type="number"]:focus,
.wm-page select:focus { border-color: var(--wm-accent); }

.wm-page input[type="range"] {
  -webkit-appearance: none;
  width: 100%; height: 4px;
  background: var(--wm-border);
  border-radius: 2px;
  outline: none;
}
.wm-page input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 16px; height: 16px;
  background: var(--wm-accent);
  border-radius: 50%;
  cursor: pointer;
}

.wm-page .range-row { display: flex; align-items: center; gap: 12px; }
.wm-page .range-row span {
  font-size: 13px; color: var(--wm-accent);
  min-width: 40px; text-align: right; font-weight: 500;
}

.wm-page .color-row { display: flex; align-items: center; gap: 10px; }
.wm-page input[type="color"] { width: 40px; height: 40px; padding: 2px; flex-shrink: 0; cursor: pointer; }
.wm-page .color-row input[type="text"] { flex: 1; }

.wm-page select { cursor: pointer; }
.wm-page select option { background: #1a1a1c; }

.wm-page .section-divider { border: none; border-top: 1px solid var(--wm-border); margin: 20px 0; }

.wm-page .logo-upload {
  border: 1px dashed var(--wm-border);
  border-radius: 8px; padding: 16px; text-align: center;
  cursor: pointer; position: relative; transition: all 0.2s;
  min-height: 80px; display: flex; align-items: center;
  justify-content: center; gap: 10px; font-size: 13px;
  color: var(--wm-muted);
}
.wm-page .logo-upload:hover { border-color: var(--wm-accent); }
.wm-page .logo-upload input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
.wm-page .logo-upload img { max-height: 48px; max-width: 100px; object-fit: contain; border-radius: 4px; }

.wm-page .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

.wm-page .preview-area {
  background: var(--wm-surface);
  border: 1px solid var(--wm-border);
  border-radius: var(--wm-radius);
  overflow: hidden;
  display: flex; flex-direction: column;
}

.wm-page .btn {
  background: var(--wm-accent);
  color: #0e0e0f; border: none;
  border-radius: 8px; padding: 10px 20px;
  font-family: 'DM Sans', sans-serif;
  font-size: 13px; font-weight: 500;
  cursor: pointer; transition: all 0.15s;
  display: inline-flex; align-items: center; gap: 6px;
  letter-spacing: 0.02em;
}
.wm-page .btn:hover { background: #f5ff70; transform: translateY(-1px); }
.wm-page .btn:active { transform: translateY(0); }

.wm-page .btn-outline {
  background: transparent; color: var(--wm-text); border: 1px solid var(--wm-border);
}
.wm-page .btn-outline:hover { background: var(--wm-surface2); border-color: var(--wm-accent); color: var(--wm-accent); transform: none; }

.wm-page .btn-sm { padding: 7px 14px; font-size: 12px; }

.wm-page .image-grid {
  padding: 20px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 16px;
  min-height: 300px;
}

.wm-page .empty-state {
  grid-column: 1 / -1;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  min-height: 260px; color: var(--wm-muted); gap: 12px;
}
.wm-page .empty-state .big-icon { font-size: 48px; opacity: 0.3; }
.wm-page .empty-state p { font-size: 14px; }

.wm-page .image-card {
  background: var(--wm-surface2);
  border: 1px solid var(--wm-border);
  border-radius: 10px; overflow: hidden;
  transition: all 0.2s; position: relative;
}
.wm-page .image-card:hover { border-color: var(--wm-accent); transform: translateY(-2px); }
.wm-page .image-card img { width: 100%; aspect-ratio: 4/3; object-fit: cover; display: block; }

.wm-page .image-card-footer { padding: 10px 12px; display: flex; align-items: center; gap: 6px; }
.wm-page .image-card-name { font-size: 11px; color: var(--wm-muted); flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.wm-page .image-card .remove-btn {
  width: 22px; height: 22px;
  background: rgba(255,85,85,0.15); border: none; border-radius: 50%;
  color: #ff5555; cursor: pointer; display: flex;
  align-items: center; justify-content: center;
  font-size: 14px; line-height: 1; flex-shrink: 0;
  transition: background 0.15s;
}
.wm-page .image-card .remove-btn:hover { background: rgba(255,85,85,0.3); }

.wm-page .progress-bar { height: 3px; background: var(--wm-border); border-radius: 2px; overflow: hidden; margin: 12px 0 0; }
.wm-page .progress-fill { height: 100%; background: linear-gradient(90deg, var(--wm-accent), var(--wm-accent2)); border-radius: 2px; transition: width 0.3s; }

.wm-page .download-section {
  padding: 20px; border-top: 1px solid var(--wm-border);
  display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
}
.wm-page .status-text { font-size: 13px; color: var(--wm-muted); flex: 1; }
.wm-page .status-text.processing { color: var(--wm-accent); }
.wm-page .status-text.done { color: #5dffb0; }

.wm-page .tabs {
  display: flex; gap: 4px;
  background: var(--wm-surface2); padding: 4px;
  border-radius: 8px; margin-bottom: 16px;
}
.wm-page .tab-btn {
  flex: 1; background: none; border: none;
  color: var(--wm-muted); font-family: 'DM Sans', sans-serif;
  font-size: 12px; font-weight: 500; padding: 7px 10px;
  border-radius: 6px; cursor: pointer;
  letter-spacing: 0.04em; text-transform: uppercase; transition: all 0.15s;
}
.wm-page .tab-btn.active { background: var(--wm-accent); color: #0e0e0f; }
.wm-page .tab-content { display: none; }
.wm-page .tab-content.active { display: block; }

.wm-page .checkbox-row { display: flex; align-items: center; gap: 10px; cursor: pointer; user-select: none; }
.wm-page .checkbox-row input[type="checkbox"] { width: 16px; height: 16px; accent-color: var(--wm-accent); cursor: pointer; }
.wm-page .checkbox-row span { font-size: 13px; color: var(--wm-text); }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TOP NAVIGATION BAR
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<nav id="app-nav">
    <span class="brand">PHOTO TOOLS</span>
    <div class="nav-links">
        <button class="nav-btn active" onclick="showPage('metadata', this)">
            üì∑ Metadata Extractor
        </button>
        <button class="nav-btn" onclick="showPage('watermark', this)">
            üñº Watermark Studio
        </button>
    </div>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE 1: METADATA EXTRACTOR
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-metadata" class="page active">
    <div class="meta-page">
        <div class="container">
            <div class="meta-header">
                <h1>Metadata</h1>
                <span class="meta-subtitle">EXIF Extractor</span>
            </div>

            <div class="upload-section">
                <div class="file-input-wrapper">
                    <input type="file" id="imageInput" accept="image/*">
                    <label for="imageInput" class="upload-label" id="uploadLabel">
                        <div class="upload-icon">üì∑</div>
                        <p><strong>Drop a photo here</strong> or click to browse</p>
                        <span>PNG, JPG, WEBP, HEIC, TIFF, RAW ‚Äî EXIF data will be extracted</span>
                    </label>
                </div>
            </div>

            <div id="loadingSection" class="loading" style="display:none;">
                <div class="spinner"></div>
                <p>Extracting metadata...</p>
            </div>

            <div id="errorSection"></div>

            <div id="previewSection" class="preview-section">
                <img id="previewImage" class="preview-image" alt="Preview">
                <div id="metadataSection"></div>
                <button class="clear-btn" onclick="metaClearAll()">‚Ü© Upload Another Photo</button>
            </div>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE 2: WATERMARK STUDIO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-watermark" class="page">
    <div class="wm-page">
        <div class="wm-container">
            <header>
                <h1>ImageMark</h1>
                <span>Watermark Studio</span>
            </header>

            <!-- Upload Zone -->
            <div class="panel" style="margin-bottom:20px;">
                <div class="panel-header">Upload Images</div>
                <div class="panel-body">
                    <div class="upload-zone" id="wmUploadZone">
                        <input type="file" id="wmFileInput" accept="image/*" multiple>
                        <div class="wm-upload-icon">üì∑</div>
                        <p><strong>Drop images here</strong> or click to browse</p>
                        <p style="margin-top:4px;font-size:12px;">JPG, PNG, WEBP ‚Äî multiple files supported</p>
                    </div>
                </div>
            </div>

            <div class="layout">
                <!-- Settings Panel -->
                <div class="panel">
                    <div class="panel-header">Settings</div>
                    <div class="panel-body">

                        <div class="tabs">
                            <button class="tab-btn active" onclick="wmSwitchTab('watermark', this)">Watermark</button>
                            <button class="tab-btn" onclick="wmSwitchTab('resize', this)">Resize</button>
                            <button class="tab-btn" onclick="wmSwitchTab('border', this)">Border</button>
                        </div>

                        <!-- WATERMARK TAB -->
                        <div id="wm-tab-watermark" class="tab-content active">
                            <div class="form-group">
                                <label>Logo (Bottom Left)</label>
                                <label class="logo-upload" id="logoDropArea">
                                    <input type="file" id="logoInput" accept="image/*">
                                    <span id="logoPlaceholder">‚äï Click to upload logo</span>
                                    <img id="logoPreview" style="display:none;">
                                </label>
                                <button class="btn btn-outline btn-sm" onclick="clearLogo()" id="clearLogoBtn" style="display:none;margin-top:6px;width:100%;">Remove Logo</button>
                            </div>

                            <div class="form-group">
                                <label>Logo Size</label>
                                <div class="range-row">
                                    <input type="range" id="logoSize" min="5" max="30" value="5">
                                    <span id="logoSizeVal">5%</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Logo Opacity</label>
                                <div class="range-row">
                                    <input type="range" id="logoOpacity" min="10" max="100" value="100">
                                    <span id="logoOpacityVal">100%</span>
                                </div>
                            </div>

                            <div class="grid2">
                                <div class="form-group">
                                    <label>Logo Offset X</label>
                                    <input type="number" id="logoOffsetX" value="24" placeholder="24">
                                </div>
                                <div class="form-group">
                                    <label>Logo Offset Y</label>
                                    <input type="number" id="logoOffsetY" value="-24" placeholder="-24">
                                </div>
                            </div>

                            <hr class="section-divider">

                            <div class="form-group">
                                <label>Watermark Text (Bottom Right)</label>
                                <input type="text" id="watermarkText" placeholder="¬© YourBrand 2025" value="First Name | Class #">
                            </div>

                            <div class="form-group">
                                <label>Font</label>
                                <select id="watermarkFont">
                                    <option value="'Segoe UI', sans-serif">Segoe UI</option>
                                    <option value="'DM Sans', sans-serif">DM Sans</option>
                                    <option value="Georgia, serif">Georgia</option>
                                    <option value="'Courier New', monospace">Courier New</option>
                                    <option value="Impact, sans-serif">Impact</option>
                                    <option value="Arial, sans-serif">Arial</option>
                                </select>
                            </div>

                            <div class="grid2">
                                <div class="form-group">
                                    <label>Font Size</label>
                                    <div class="range-row">
                                        <input type="range" id="textSize" min="10" max="72" value="24">
                                        <span id="textSizeVal">24</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Opacity</label>
                                    <div class="range-row">
                                        <input type="range" id="textOpacity" min="10" max="100" value="100">
                                        <span id="textOpacityVal">100%</span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Text Color</label>
                                <div class="color-row">
                                    <input type="color" id="textColorPicker" value="#ffffff">
                                    <input type="text" id="textColorHex" value="#ffffff" placeholder="#ffffff">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Text Shadow</label>
                                <label class="checkbox-row">
                                    <input type="checkbox" id="textShadow" checked>
                                    <span>Add drop shadow for readability</span>
                                </label>
                            </div>

                            <div class="grid2">
                                <div class="form-group">
                                    <label>Text Offset X</label>
                                    <input type="number" id="textOffsetX" value="-24" placeholder="-24">
                                </div>
                                <div class="form-group">
                                    <label>Text Offset Y</label>
                                    <input type="number" id="textOffsetY" value="-24" placeholder="-24">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Padding from Edge</label>
                                <div class="range-row">
                                    <input type="range" id="wmPadding" min="5" max="50" value="16">
                                    <span id="wmPaddingVal">16px</span>
                                </div>
                            </div>
                        </div>

                        <!-- RESIZE TAB -->
                        <div id="wm-tab-resize" class="tab-content">
                            <div class="form-group">
                                <label class="checkbox-row" style="margin-bottom:8px;">
                                    <input type="checkbox" id="enableResize" checked>
                                    <span>Enable Resize</span>
                                </label>
                            </div>

                            <div class="form-group">
                                <label>Resize Mode</label>
                                <select id="resizeMode">
                                    <option value="width" selected>By Width</option>
                                    <option value="height">By Height</option>
                                    <option value="both">Exact (Width √ó Height)</option>
                                    <option value="percent">Percentage</option>
                                </select>
                            </div>

                            <div class="grid2" id="resizeDims">
                                <div class="form-group">
                                    <label>Width (px)</label>
                                    <input type="number" id="resizeWidth" value="2048" min="10" max="10000">
                                </div>
                                <div class="form-group">
                                    <label>Height (px)</label>
                                    <input type="number" id="resizeHeight" value="800" min="10" max="10000">
                                </div>
                            </div>

                            <div class="form-group" id="resizePercentGroup" style="display:none;">
                                <label>Scale Percentage</label>
                                <div class="range-row">
                                    <input type="range" id="resizePercent" min="10" max="200" value="100">
                                    <span id="resizePercentVal">100%</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-row">
                                    <input type="checkbox" id="keepAspect" checked>
                                    <span>Keep aspect ratio</span>
                                </label>
                            </div>
                        </div>

                        <!-- BORDER TAB -->
                        <div id="wm-tab-border" class="tab-content">
                            <div class="form-group">
                                <label class="checkbox-row" style="margin-bottom:16px;">
                                    <input type="checkbox" id="enableBorder" checked>
                                    <span>Enable Border</span>
                                </label>
                            </div>

                            <div class="form-group">
                                <label>Border Width</label>
                                <div class="range-row">
                                    <input type="range" id="borderWidth" min="1" max="80" value="6">
                                    <span id="borderWidthVal">6px</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Border Color</label>
                                <div class="color-row">
                                    <input type="color" id="borderColorPicker" value="#ffffff">
                                    <input type="text" id="borderColorHex" value="#ffffff" placeholder="#ffffff">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Border Style</label>
                                <select id="borderStyle">
                                    <option value="solid">Solid</option>
                                    <option value="double">Double (inner line)</option>
                                    <option value="shadow">Inset Shadow</option>
                                </select>
                            </div>

                            <div class="form-group" id="doubleLineGroup" style="display:none;">
                                <label>Inner Line Width</label>
                                <div class="range-row">
                                    <input type="range" id="innerLineWidth" min="1" max="10" value="2">
                                    <span id="innerLineWidthVal">2px</span>
                                </div>
                            </div>
                        </div>

                        <hr class="section-divider">

                        <div class="form-group">
                            <label>Output Format</label>
                            <select id="outputFormat">
                                <option value="image/jpeg">JPEG</option>
                                <option value="image/png">PNG</option>
                                <option value="image/webp">WebP</option>
                            </select>
                        </div>

                        <div class="form-group" id="qualityGroup">
                            <label>JPEG Quality</label>
                            <div class="range-row">
                                <input type="range" id="outputQuality" min="50" max="100" value="100">
                                <span id="outputQualityVal">100%</span>
                            </div>
                        </div>

                        <button class="btn" style="width:100%;" onclick="processAll()">
                            ‚ö° Process All Images
                        </button>
                    </div>
                </div>

                <!-- Preview + Download Panel -->
                <div class="preview-area">
                    <div class="panel-header" style="background:var(--wm-surface);padding:16px 20px;">
                        <span style="color:var(--wm-accent);">‚óè</span>
                        <span style="font-size:11px;font-weight:500;letter-spacing:0.12em;text-transform:uppercase;color:var(--wm-muted);">Preview &amp; Output</span>
                        <div style="flex:1;"></div>
                        <button class="btn btn-outline btn-sm" onclick="wmClearAll()">Clear All</button>
                    </div>

                    <div class="image-grid" id="imageGrid">
                        <div class="empty-state">
                            <div class="big-icon">üñºÔ∏è</div>
                            <p>Upload images to get started</p>
                        </div>
                    </div>

                    <div class="download-section">
                        <div class="status-text" id="statusText">No images loaded</div>
                        <button class="btn btn-outline" onclick="previewCurrent()" id="previewBtn" style="display:none;">üëÅ Preview</button>
                        <button class="btn" onclick="downloadAll()" id="downloadBtn" style="display:none;">‚Üì Download All</button>
                    </div>

                    <div id="progressContainer" style="padding:0 20px 16px;display:none;">
                        <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
                        <p style="font-size:11px;color:var(--wm-muted);margin-top:6px;" id="progressLabel">Processing...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<canvas id="workCanvas" style="display:none;"></canvas>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCRIPTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script src="https://unpkg.com/exifr"></script>
<script>
/* ‚îÄ‚îÄ‚îÄ PAGE SWITCHING ‚îÄ‚îÄ‚îÄ */
function showPage(name, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('#app-nav .nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  btn.classList.add('active');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   METADATA EXTRACTOR
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const imageInput    = document.getElementById('imageInput');
const uploadLabel   = document.getElementById('uploadLabel');
const loadingSection = document.getElementById('loadingSection');
const errorSection  = document.getElementById('errorSection');
const previewSection = document.getElementById('previewSection');
const previewImage  = document.getElementById('previewImage');
const metadataSection = document.getElementById('metadataSection');

uploadLabel.addEventListener('dragover', e => { e.preventDefault(); uploadLabel.classList.add('drag-over'); });
uploadLabel.addEventListener('dragleave', () => uploadLabel.classList.remove('drag-over'));
uploadLabel.addEventListener('drop', e => {
  e.preventDefault(); uploadLabel.classList.remove('drag-over');
  const files = e.dataTransfer.files;
  if (files.length > 0) { imageInput.files = files; metaProcessImage(); }
});
imageInput.addEventListener('change', metaProcessImage);

async function metaProcessImage() {
  const file = imageInput.files[0];
  if (!file) return;
  loadingSection.style.display = 'block';
  errorSection.innerHTML = '';
  previewSection.classList.remove('active');
  try {
    const reader = new FileReader();
    reader.onload = e => { previewImage.src = e.target.result; };
    reader.readAsDataURL(file);
    const exifData = await exifr.parse(file, { mergeOutput: true });
    loadingSection.style.display = 'none';
    displayMetadata(exifData);
  } catch (error) {
    loadingSection.style.display = 'none';
    metaShowError(`Error extracting metadata: ${error.message}`);
  }
}

function displayMetadata(exifData) {
  if (!exifData || Object.keys(exifData).length === 0) {
    metaShowError('No EXIF metadata found in this image.');
    previewSection.classList.add('active');
    return;
  }
  let html = '';
  const cameraInfo = { Make: exifData.Make, Model: exifData.Model, Software: exifData.Software, DateTime: exifData.DateTime };
  const lensInfo = { LensMake: exifData.LensMake, LensModel: exifData.LensModel, LensSerialNumber: exifData.LensSerialNumber, LensSpecification: exifData.LensSpecification };
  const shootingSettings = {
    ExposureTime: exifData.ExposureTime ? `1/${Math.round(1/exifData.ExposureTime)}s` : 'N/A',
    FNumber: exifData.FNumber ? `f/${exifData.FNumber}` : 'N/A',
    ISOSpeedRatings: exifData.ISOSpeedRatings || exifData.ISO || 'N/A',
    FocalLength: exifData.FocalLength ? `${exifData.FocalLength}mm` : 'N/A',
    FocalLengthIn35mmFilm: exifData.FocalLengthIn35mmFilm ? `${exifData.FocalLengthIn35mmFilm}mm` : 'N/A',
    MaxAperture: exifData.MaxAperture ? `f/${exifData.MaxAperture}` : 'N/A'
  };
  html += buildCameraSection(cameraInfo);
  html += buildLensSection(lensInfo);
  html += buildMetadataSection('Shooting Settings', shootingSettings);
  metadataSection.innerHTML = html;
  previewSection.classList.add('active');
}

function buildCameraSection(info) {
  const hasCamera = Object.values(info).some(v => v);
  if (!hasCamera) return '';
  return `<div class="camera-info">
    <div class="camera-info-item"><h4>Camera Make</h4><p>${info.Make||'Unknown'}</p></div>
    <div class="camera-info-item"><h4>Camera Model</h4><p>${info.Model||'Unknown'}</p></div>
    <div class="camera-info-item"><h4>Date Taken</h4><p>${formatDate(info.DateTime)||'Unknown'}</p></div>
    <div class="camera-info-item"><h4>Software</h4><p>${info.Software||'Unknown'}</p></div>
  </div>`;
}

function buildLensSection(info) {
  const hasLens = Object.values(info).some(v => v);
  if (!hasLens) return '';
  let lensSpec = 'N/A';
  if (info.LensSpecification) {
    lensSpec = Array.isArray(info.LensSpecification) ? `${info.LensSpecification[0]}-${info.LensSpecification[1]}mm` : info.LensSpecification;
  }
  return `<div class="metadata-container">
    <div class="metadata-card">
      <h3>Lens Information</h3>
      <div class="metadata-grid">
        <div class="metadata-item"><strong>Lens Make</strong><span>${info.LensMake||'Unknown'}</span></div>
        <div class="metadata-item"><strong>Lens Model</strong><span>${info.LensModel||'Unknown'}</span></div>
        <div class="metadata-item"><strong>Lens Specification</strong><span>${lensSpec}</span></div>
        <div class="metadata-item"><strong>Serial Number</strong><span>${info.LensSerialNumber||'Unknown'}</span></div>
      </div>
    </div>
  </div>`;
}

function buildMetadataSection(title, data) {
  const hasData = Object.values(data).some(v => v !== 'N/A');
  if (!hasData) return '';
  let html = `<div class="metadata-container"><div class="metadata-card"><h3>${title}</h3><div class="metadata-grid">`;
  for (const [key, value] of Object.entries(data)) {
    const displayKey = key.replace(/([A-Z])/g, ' $1').trim();
    html += `<div class="metadata-item"><strong>${displayKey}</strong><span>${value||'N/A'}</span></div>`;
  }
  html += `</div></div></div>`;
  return html;
}

function metaShowError(message) { errorSection.innerHTML = `<div class="error">‚ö†Ô∏è ${message}</div>`; }
function metaClearAll() { imageInput.value=''; previewSection.classList.remove('active'); errorSection.innerHTML=''; loadingSection.style.display='none'; }
function formatDate(dateStr) {
  if (!dateStr) return null;
  try { return new Date(dateStr.replace(/[:\-]/g,'/')).toLocaleString(); } catch { return dateStr; }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   WATERMARK STUDIO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let files = [], processedBlobs = [], logoImage = null;

function wmBindRange(id, display, suffix='') {
  const el = document.getElementById(id);
  const disp = document.getElementById(display);
  if (el && disp) el.addEventListener('input', () => { disp.textContent = el.value + suffix; });
}

wmBindRange('logoSize','logoSizeVal','%');
wmBindRange('logoOpacity','logoOpacityVal','%');
wmBindRange('textSize','textSizeVal','');
wmBindRange('textOpacity','textOpacityVal','%');
wmBindRange('wmPadding','wmPaddingVal','px');
wmBindRange('borderWidth','borderWidthVal','px');
document.getElementById('borderWidthVal').textContent = '6px';
wmBindRange('innerLineWidth','innerLineWidthVal','px');
wmBindRange('resizePercent','resizePercentVal','%');
wmBindRange('outputQuality','outputQualityVal','%');

// Color sync
function wmSyncColor(pickerId, hexId) {
  document.getElementById(pickerId).addEventListener('input', e => { document.getElementById(hexId).value = e.target.value; });
  document.getElementById(hexId).addEventListener('input', e => { if (/^#[0-9a-f]{6}$/i.test(e.target.value)) document.getElementById(pickerId).value = e.target.value; });
}
wmSyncColor('textColorPicker','textColorHex');
wmSyncColor('borderColorPicker','borderColorHex');

document.getElementById('outputFormat').addEventListener('change', e => {
  document.getElementById('qualityGroup').style.display = e.target.value === 'image/jpeg' ? 'block' : 'none';
});
document.getElementById('borderStyle').addEventListener('change', e => {
  document.getElementById('doubleLineGroup').style.display = e.target.value === 'double' ? 'block' : 'none';
});
document.getElementById('resizeMode').addEventListener('change', e => {
  const pct = e.target.value === 'percent';
  document.getElementById('resizeDims').style.display = pct ? 'none' : 'grid';
  document.getElementById('resizePercentGroup').style.display = pct ? 'block' : 'none';
});

function wmSwitchTab(name, btn) {
  document.querySelectorAll('.wm-page .tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.wm-page .tab-content').forEach(c => c.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('wm-tab-'+name).classList.add('active');
}

document.getElementById('logoInput').addEventListener('change', e => {
  const file = e.target.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    const img = new Image();
    img.onload = () => {
      logoImage = img;
      document.getElementById('logoPreview').src = ev.target.result;
      document.getElementById('logoPreview').style.display = 'block';
      document.getElementById('logoPlaceholder').style.display = 'none';
      document.getElementById('clearLogoBtn').style.display = 'block';
    };
    img.src = ev.target.result;
  };
  reader.readAsDataURL(file);
});

function clearLogo() {
  logoImage = null;
  document.getElementById('logoPreview').style.display = 'none';
  document.getElementById('logoPlaceholder').style.display = '';
  document.getElementById('clearLogoBtn').style.display = 'none';
  document.getElementById('logoInput').value = '';
}

const wmFileInput = document.getElementById('wmFileInput');
const wmUploadZone = document.getElementById('wmUploadZone');
wmFileInput.addEventListener('change', e => wmAddFiles(e.target.files));
wmUploadZone.addEventListener('dragover', e => { e.preventDefault(); wmUploadZone.classList.add('drag-over'); });
wmUploadZone.addEventListener('dragleave', () => wmUploadZone.classList.remove('drag-over'));
wmUploadZone.addEventListener('drop', e => { e.preventDefault(); wmUploadZone.classList.remove('drag-over'); wmAddFiles(e.dataTransfer.files); });

function wmAddFiles(newFiles) {
  for (const f of newFiles) { if (f.type.startsWith('image/')) files.push(f); }
  wmRenderGrid(); wmUpdateStatus();
}
function removeFile(idx) { files.splice(idx,1); processedBlobs.splice(idx,1); wmRenderGrid(); wmUpdateStatus(); }
function wmClearAll() { files=[]; processedBlobs=[]; wmRenderGrid(); wmUpdateStatus(); }

function wmRenderGrid() {
  const grid = document.getElementById('imageGrid');
  if (files.length === 0) {
    grid.innerHTML = '<div class="empty-state"><div class="big-icon">üñºÔ∏è</div><p>Upload images to get started</p></div>';
    return;
  }
  grid.innerHTML = '';
  files.forEach((f, i) => {
    const card = document.createElement('div');
    card.className = 'image-card';
    const url = processedBlobs[i] ? URL.createObjectURL(processedBlobs[i]) : URL.createObjectURL(f);
    const badge = processedBlobs[i] ? '<span style="position:absolute;top:8px;right:8px;background:#5dffb0;color:#000;font-size:10px;font-weight:600;padding:2px 7px;border-radius:4px;letter-spacing:0.05em;">DONE</span>' : '';
    card.innerHTML = `<div style="position:relative;"><img src="${url}" alt="${f.name}">${badge}</div>
      <div class="image-card-footer"><span class="image-card-name">${f.name}</span>
      <button class="remove-btn" onclick="removeFile(${i})">√ó</button></div>`;
    grid.appendChild(card);
  });
}

function wmUpdateStatus() {
  const st = document.getElementById('statusText');
  const dlBtn = document.getElementById('downloadBtn');
  const pvBtn = document.getElementById('previewBtn');
  if (files.length === 0) {
    st.textContent = 'No images loaded'; st.className = 'status-text';
    dlBtn.style.display = 'none'; pvBtn.style.display = 'none';
  } else if (processedBlobs.filter(Boolean).length === files.length) {
    st.textContent = `‚úì ${files.length} image${files.length>1?'s':''} processed`;
    st.className = 'status-text done'; dlBtn.style.display = ''; pvBtn.style.display = '';
  } else {
    st.textContent = `${files.length} image${files.length>1?'s':''} loaded ‚Äî click Process`;
    st.className = 'status-text'; dlBtn.style.display = 'none'; pvBtn.style.display = 'none';
  }
}

function getSettings() {
  return {
    text: document.getElementById('watermarkText').value,
    font: document.getElementById('watermarkFont').value,
    textSize: parseInt(document.getElementById('textSize').value),
    textOpacity: parseInt(document.getElementById('textOpacity').value) / 100,
    textColor: document.getElementById('textColorHex').value,
    textShadow: document.getElementById('textShadow').checked,
    textOffsetX: parseInt(document.getElementById('textOffsetX').value) || 0,
    textOffsetY: parseInt(document.getElementById('textOffsetY').value) || 0,
    logoSize: parseInt(document.getElementById('logoSize').value) / 100,
    logoOpacity: parseInt(document.getElementById('logoOpacity').value) / 100,
    logoOffsetX: parseInt(document.getElementById('logoOffsetX').value) || 0,
    logoOffsetY: parseInt(document.getElementById('logoOffsetY').value) || 0,
    padding: parseInt(document.getElementById('wmPadding').value),
    enableResize: document.getElementById('enableResize').checked,
    resizeMode: document.getElementById('resizeMode').value,
    resizeWidth: parseInt(document.getElementById('resizeWidth').value),
    resizeHeight: parseInt(document.getElementById('resizeHeight').value),
    resizePercent: parseInt(document.getElementById('resizePercent').value) / 100,
    keepAspect: document.getElementById('keepAspect').checked,
    enableBorder: document.getElementById('enableBorder').checked,
    borderWidth: parseInt(document.getElementById('borderWidth').value),
    borderColor: document.getElementById('borderColorHex').value,
    borderStyle: document.getElementById('borderStyle').value,
    innerLineWidth: parseInt(document.getElementById('innerLineWidth').value),
    format: document.getElementById('outputFormat').value,
    quality: parseInt(document.getElementById('outputQuality').value) / 100,
  };
}

function wmProcessImage(file, settings) {
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.onload = ev => {
      const img = new Image();
      img.onload = () => {
        let w = img.width, h = img.height;
        if (settings.enableResize) {
          if (settings.resizeMode === 'percent') { w = Math.round(w*settings.resizePercent); h = Math.round(h*settings.resizePercent); }
          else if (settings.resizeMode === 'width') { const s = settings.resizeWidth/w; w = settings.resizeWidth; h = settings.keepAspect ? Math.round(h*s) : h; }
          else if (settings.resizeMode === 'height') { const s = settings.resizeHeight/h; h = settings.resizeHeight; w = settings.keepAspect ? Math.round(w*s) : w; }
          else { w = settings.resizeWidth; h = settings.resizeHeight; }
        }
        const bw = settings.enableBorder ? settings.borderWidth : 0;
        const canvasW = w + bw*2, canvasH = h + bw*2;
        const canvas = document.getElementById('workCanvas');
        canvas.width = canvasW; canvas.height = canvasH;
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvasW, canvasH);
        if (settings.enableBorder) {
          ctx.fillStyle = settings.borderColor;
          ctx.fillRect(0, 0, canvasW, canvasH);
          if (settings.borderStyle === 'shadow') { ctx.shadowColor='rgba(0,0,0,0.4)'; ctx.shadowBlur=bw*0.8; ctx.shadowOffsetX=0; ctx.shadowOffsetY=0; }
        }
        ctx.shadowColor='transparent'; ctx.shadowBlur=0;
        ctx.drawImage(img, bw, bw, w, h);
        if (settings.enableBorder && settings.borderStyle === 'double') {
          const lw = settings.innerLineWidth;
          ctx.strokeStyle = 'rgba(0,0,0,0.25)'; ctx.lineWidth = lw;
          const inset = bw - lw - 4;
          if (inset > 0) ctx.strokeRect(inset, inset, canvasW-inset*2, canvasH-inset*2);
        }
        if (logoImage) {
          const logoMaxW = w * settings.logoSize;
          const logoScale = logoMaxW / logoImage.width;
          const lw = logoImage.width * logoScale, lh = logoImage.height * logoScale;
          const lx = bw + settings.padding + settings.logoOffsetX;
          const ly = bw + h - lh - settings.padding + settings.logoOffsetY;
          ctx.globalAlpha = settings.logoOpacity;
          ctx.drawImage(logoImage, lx, ly, lw, lh);
          ctx.globalAlpha = 1;
        }
        if (settings.text) {
          ctx.globalAlpha = settings.textOpacity;
          ctx.font = `${settings.textSize}px ${settings.font}`;
          ctx.textAlign = 'right'; ctx.textBaseline = 'bottom';
          const tx = bw + w - settings.padding + settings.textOffsetX;
          const ty = bw + h - settings.padding + settings.textOffsetY;
          if (settings.textShadow) { ctx.shadowColor='rgba(0,0,0,0.7)'; ctx.shadowBlur=6; ctx.shadowOffsetX=1; ctx.shadowOffsetY=1; }
          ctx.fillStyle = settings.textColor;
          ctx.fillText(settings.text, tx, ty);
          ctx.shadowColor='transparent'; ctx.shadowBlur=0; ctx.globalAlpha=1;
        }
        canvas.toBlob(blob => resolve(blob), settings.format, settings.quality);
      };
      img.src = ev.target.result;
    };
    reader.readAsDataURL(file);
  });
}

async function processAll() {
  if (files.length === 0) { alert('Please upload images first.'); return; }
  const settings = getSettings();
  processedBlobs = [];
  document.getElementById('progressContainer').style.display = 'block';
  document.getElementById('statusText').textContent = 'Processing...';
  document.getElementById('statusText').className = 'status-text processing';
  for (let i = 0; i < files.length; i++) {
    const pct = Math.round((i / files.length) * 100);
    document.getElementById('progressFill').style.width = pct + '%';
    document.getElementById('progressLabel').textContent = `Processing ${i+1} of ${files.length}: ${files[i].name}`;
    const blob = await wmProcessImage(files[i], settings);
    processedBlobs.push(blob);
  }
  document.getElementById('progressFill').style.width = '100%';
  document.getElementById('progressLabel').textContent = 'Done!';
  setTimeout(() => { document.getElementById('progressContainer').style.display = 'none'; }, 1500);
  wmRenderGrid(); wmUpdateStatus();
}

function getExtension(format) { return {'image/jpeg':'jpg','image/png':'png','image/webp':'webp'}[format]||'jpg'; }

function downloadAll() {
  const format = document.getElementById('outputFormat').value;
  const ext = getExtension(format);
  processedBlobs.forEach((blob, i) => {
    if (!blob) return;
    const a = document.createElement('a');
    const base = files[i].name.replace(/\.[^.]+$/,'');
    a.download = `${base}_watermarked.${ext}`;
    a.href = URL.createObjectURL(blob);
    a.click();
    URL.revokeObjectURL(a.href);
  });
}

function previewCurrent() {
  if (!processedBlobs[0]) return;
  window.open(URL.createObjectURL(processedBlobs[0]), '_blank');
}
</script>
</body>
</html>
